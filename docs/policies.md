# ポリシー（Policies）

## 最重要ポリシー（違反したら即中止）

### P-001 禁止操作

- プロジェクトで禁止されている操作を定義する。
- CI の `policy_check.py` で機械的に検査する。
<!-- 例:
- 外部 API への直接接続を禁止する
- 本番環境への書き込みを禁止する
  -->

### P-002 秘密情報禁止

- API キー、トークン、認証情報、個人情報をリポジトリに含めない。
- `.env` はローカルのみとし、`.env.example` は変数名のみを記載する。
- CI の `policy_check.py` で秘密情報パターンを検査する。

### P-003 制約最優先

- ドメインロジックの判断より、制約の判定を常に優先する。
- 制約回避（スキップ、無効化、ハードコード回避）は禁止する。
- 例外が必要な場合は ADR を作成し、期限と復帰条件を定義する。

## 安全停止

### P-010 フェイルクローズ

- 判断不能（データ不整合、欠損、未定義状態）の場合は安全側に倒す。
- 疑わしい場合は処理を中止する。

### P-011 異常時停止

- エラー連鎖、制約違反の連鎖時は安全に停止する。
- 停止条件・解除条件は `docs/constraints.md` を正本とする。

## 監査と証跡

### P-020 監査ログ

- 重要な判断、制約判定、例外を記録する。
- ログには秘密情報を含めない。
- 拒否理由コードを付与し、後から追跡可能にする。

### P-021 再現性証跡

- 設定、シード、データ参照、コミット SHA を記録し、再実行可能にする。
- 再現性は自動テストで担保する（同一入力 → 同一出力）。

## 変更管理（正本運用）

### P-030 正本優先

- 仕様変更は `docs/requirements.md` または `docs/policies.md` に反映する。
- 計画変更は `docs/plan.md` を上書き更新する。
- 重要判断は `docs/adr/` に残す。plan に長文履歴を残さない。
- 会話ログを仕様の根拠にしない。決定事項は必ず正本に反映する。

### P-031 変更粒度

- 1PR は単一の意図で説明できる範囲に分割する。
- 大規模変更は段階的に分割し、必要なら ADR で分割方針を定義する。

## 言語規約

### P-032 日本語原則

- PR タイトル/本文、Issue 本文、レビューコメント、ADR、docs 更新は日本語で書く。
- コードの識別子（変数名、関数名等）は英語で書く。
- コード内のコメント・docstring は日本語で書く。

## 依存関係と供給網

### P-040 依存追加・更新の監査

- 依存関係の追加・更新は監査対象とし、最小限に留める。
- ライセンスや脆弱性が懸念される場合は、ADR に根拠と対応方針を残す。

## データ取り扱い

### P-050 データの取扱い

- 個人情報や非公開情報は取り込まない。
- 実データを扱う場合は、リポジトリ外に置き、`.gitignore` で除外する。

## 例外運用

### P-900 例外の扱い

- ポリシー例外は ADR に記載し、期限（いつ戻すか）と検証方法を明記する。
- 例外の承認は明示的に行い、暗黙の例外は認めない。
