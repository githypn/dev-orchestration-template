# 制約仕様（Constraints）

## 目的

プロジェクトの制約（安全性、品質、運用上の制限）を定義する。本ファイルは制約の仕様正本であり、実装は本ファイルに追従する。

## 制約の適用範囲

- すべての処理は、実行前に制約を評価する。
- 判断不能な場合は安全側に倒す（フェイルクローズ）。
- 制約判定は一箇所に集約し、回避できない構造にする。

## 制約一覧

> しきい値はプロジェクト固有に設定する。初期値は ADR で根拠を明記する。

### C-001 <!-- 制約名 -->

| パラメータ | 値          | 備考          |
| ---------- | ----------- | ------------- |
| しきい値   | <!-- 値 --> | <!-- 根拠 --> |

- 判定：<!-- トリガー条件を記載 -->
- 理由コード：`C001_xxx`

### C-002 <!-- 制約名 -->

| パラメータ | 値          | 備考          |
| ---------- | ----------- | ------------- |
| しきい値   | <!-- 値 --> | <!-- 根拠 --> |

- 判定：<!-- トリガー条件を記載 -->
- 理由コード：`C002_xxx`

<!-- 必要に応じて追加 -->

## 状態遷移（必要な場合）

```
RUNNING ──(品質低下)──→ DEGRADED ──(制約違反/異常連鎖)──→ HALTED
   ↑                      │                               │
   └────(手動復帰)────────┘                               │
   └──────────────(手動復帰)───────────────────────────────┘
```

| 状態     | 説明     | 新規操作             |
| -------- | -------- | -------------------- |
| RUNNING  | 通常稼働 | 許可（制約評価あり） |
| DEGRADED | 品質低下 | 制限                 |
| HALTED   | 安全停止 | 禁止                 |

## 実装要件

- 制約判定は一箇所に集約し、ドメインロジックが回避できない構造にする
- 判定結果には拒否理由コードを付与する（監査ログ用）
- 制約は境界値テストを必須とする（しきい値ちょうど、直上、直下）
- 状態遷移のテストを必須とする（該当する場合）

## 見直し

- しきい値は検証結果に基づき更新する
- 更新時は plan と ADR の整合を取る
