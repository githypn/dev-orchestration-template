# セキュリティポリシーテンプレート

> このドキュメントは、エージェント駆動開発プロジェクトにおけるセキュリティポリシーのテンプレートである。
> プロジェクト導入時に各セクションをカスタマイズし、プロジェクト固有の `docs/security-policy.md` として使用すること。

---

## 1. OWASP Top 10 for Agentic Applications 2026 概要

OWASP GenAI Security Project が 2025年12月10日に公開した、自律的 AI エージェントシステムにおける重大なセキュリティリスクトップ10のフレームワーク。100名以上の専門家によるピアレビュー済みの公式ガイドライン。

本テンプレートでは、エージェント駆動開発に特に関連の深い以下のリスクを対策対象とする。

### ASI01 - Agent Goal Hijack（エージェント目標の乗っ取り）

プロンプトインジェクションや汚染された入力データを通じてエージェントの目標・動作を攻撃者が制御する攻撃。

**主なリスク**: 外部から取得したコンテンツ（ファイル内容・Web ページ・PR コメント等）に埋め込まれた悪意ある指示を、エージェントが正規の命令として実行してしまう。

### ASI02 - Tool Misuse（ツールの誤用）

正当な権限内でツールを悪用し、意図しない有害な操作を引き起こす攻撃。

**主なリスク**: エージェントが保有するツール権限を利用して、本来のタスク範囲を超えた操作（ファイル削除、認証情報の読み取り等）を実行してしまう。

### ASI03 - Identity & Privilege Abuse（アイデンティティと権限の悪用）

エージェントが継承・委譲された認証情報・権限の範囲を逸脱して操作を行う攻撃。

**主なリスク**: エージェントに付与された GitHub トークンや API キーの権限範囲を超えた操作が実行される。

### ASI06 - Memory & Context Poisoning（メモリとコンテキストの汚染）

エージェントの永続メモリ、Embeddings、共有コンテキストを汚染し将来の動作を操作する攻撃。

**主なリスク**: 外部データソースからの入力を通じてエージェントのコンテキストが汚染され、以降の判断に影響を与える。

### ASI07 - Insecure Inter-Agent Communication（安全でないエージェント間通信）

エージェント間の通信経路が認証・暗号化されていないことを利用した盗聴・なりすまし攻撃。

**主なリスク**: 委譲先エージェントのなりすまし、または委譲先エージェントからの応答の改ざんにより、不正なコードや指示が混入する。

---

## 2. ASI 識別子別 実装チェックリスト

プロジェクト導入時に以下のチェックリストを確認し、すべてが対応済みであることを確認すること。

### ASI01 - Agent Goal Hijack 対策

- [ ] Orchestrator テンプレートに「目標乗っ取り防止」セクションが記載されている
- [ ] 外部コンテンツ（ファイル・Web・PR コメント）に含まれる指示文字列を自動実行しないルールが明記されている
- [ ] 疑わしい指示を検出した場合に人間へエスカレーションするフローが定義されている
- [ ] {{プロジェクト固有のチェック項目}} <!-- CUSTOMIZE: プロジェクト固有の ASI01 対策を追加 -->

### ASI02 - Tool Misuse 対策

- [ ] 全エージェントで最小特権の原則が適用されている（不要なツール権限が付与されていない）
- [ ] エージェント権限マトリクス（§4）が作成され、全エージェントのツール権限が文書化されている
- [ ] 不可逆操作のリストが定義され、HITL 承認が必須化されている
- [ ] `editFiles` 権限を持たないエージェント（auditor 系）がコードを変更できないことが確認されている
- [ ] {{プロジェクト固有のチェック項目}} <!-- CUSTOMIZE: プロジェクト固有の ASI02 対策を追加 -->

### ASI03 - Identity & Privilege Abuse 対策

- [ ] GitHub Token の権限が必要最小限に設定されている（例: `contents: read`, `pull-requests: write`）
- [ ] HITL 承認リスト（不可逆操作）が全エージェントに記載されている
- [ ] 人間の最終承認なしに本番ブランチへのマージが実行されない設計になっている
- [ ] {{プロジェクト固有のチェック項目}} <!-- CUSTOMIZE: プロジェクト固有の ASI03 対策を追加 -->

### ASI06 - Memory & Context Poisoning 対策

- [ ] 全エージェントに「外部入力のサニタイズ」セクションが記載されている
- [ ] 外部データは Untrusted Data として扱うルールが明記されている
- [ ] 外部データに含まれる指示を自動実行しないルールが明記されている
- [ ] {{プロジェクト固有のチェック項目}} <!-- CUSTOMIZE: プロジェクト固有の ASI06 対策を追加 -->

### ASI07 - Insecure Inter-Agent Communication 対策

- [ ] エージェント間通信の認証ルールが Orchestrator に記載されている
- [ ] 委譲先エージェントの身元確認方法（定義ファイルパスによる識別）が明記されている
- [ ] 委譲先エージェントからの応答を Untrusted Data として扱うルールが明記されている
- [ ] 応答の正当性確認（報告フォーマットへの準拠チェック）が明記されている
- [ ] {{プロジェクト固有のチェック項目}} <!-- CUSTOMIZE: プロジェクト固有の ASI07 対策を追加 -->

---

## 3. 不可逆操作の定義ガイド

### 3.1 不可逆操作とは

エージェントが実行した場合に、元の状態に戻すことが困難または不可能な操作を指す。
これらの操作は実行前に必ず人間の確認（HITL 承認）を必要とする。

### 3.2 デフォルトの不可逆操作リスト

以下はすべてのプロジェクトで共通して不可逆操作として扱うべき操作である。

| 操作 | リスク | 対象エージェント |
|---|---|---|
| 本番ブランチへの直接コミット・プッシュ | コードの破損・本番環境への影響 | 全エージェント |
| Pull Request のマージ | 不可逆的なコード統合 | Orchestrator, Release Manager |
| 外部サービスへのデータ送信 | データ漏洩・意図しない外部通信 | 全エージェント |
| ファイルの削除操作 | データ喪失 | Implementer, Orchestrator |

### 3.3 プロジェクト固有の不可逆操作の定義方法

プロジェクトの特性に応じて、以下の観点で不可逆操作を追加定義すること。

<!-- CUSTOMIZE: 以下の表にプロジェクト固有の不可逆操作を追加すること -->

**判断基準**:

1. **復元コスト**: 操作を元に戻すのにどの程度のコスト（時間・人的リソース）がかかるか
2. **影響範囲**: 操作が他のシステム・ユーザー・データに与える影響の広さ
3. **機密性**: 操作が機密データ・認証情報に関わるか

**不可逆操作の追加テンプレート**:

| 操作 | リスク | 対象エージェント |
|---|---|---|
| {{操作名}} | {{想定されるリスク}} | {{影響を受けるエージェント}} |

### 3.4 不可逆操作リストの運用ルール

- 不可逆操作リストは `docs/security-policy.md`（本ファイルのプロジェクト版）に正本として管理する
- 各エージェント定義ファイルの「不可逆操作の HITL 承認」セクションは本リストと同期させること
- 不可逆操作の追加・変更は ADR に記録すること

---

## 4. エージェント権限マトリクス

以下の表にプロジェクトの全エージェントとそのツール権限を記入する。
`✅` = 付与、`❌` = 非付与、`⚠️` = 条件付き付与（条件を備考に記載）

<!-- CUSTOMIZE: プロジェクトのエージェント構成とツールに合わせて表を編集すること -->

| エージェント | read | editFiles | runInTerminal | search | agent | web/fetch | web/githubRepo | mcp |
|---|---|---|---|---|---|---|---|---|
| Orchestrator | ✅ | ✅ | ✅ | ✅ | ✅ | ⚠️ | ✅ | ⚠️ |
| Implementer | ✅ | ✅ | ✅ | ✅ | ❌ | ❌ | ❌ | ⚠️ |
| Test Engineer | ✅ | ✅ | ✅ | ✅ | ❌ | ❌ | ❌ | ❌ |
| Auditor Spec | ✅ | ❌ | ❌ | ✅ | ❌ | ❌ | ❌ | ❌ |
| Auditor Security | ✅ | ❌ | ❌ | ✅ | ❌ | ❌ | ❌ | ❌ |
| Auditor Reliability | ✅ | ❌ | ❌ | ✅ | ❌ | ❌ | ❌ | ⚠️ |
| Release Manager | ✅ | ❌ | ✅ | ✅ | ❌ | ❌ | ❌ | ❌ |

**⚠️ 条件付き付与の備考**:

| エージェント | ツール | 条件 |
|---|---|---|
| Orchestrator | web/fetch | 外部 Web ページの取得が必要な場合のみ |
| Orchestrator | mcp | MCP サーバーを利用する場合のみ |
| Implementer | mcp | Serena 等のセマンティック分析ツールを利用する場合のみ |
| Auditor Reliability | mcp | Serena 等のセマンティック検証ツールを利用する場合のみ |

### 4.1 権限マトリクスの運用ルール

- **追加時の審査**: 新しいツール権限をエージェントに追加する場合は、その必要性を ADR に記録すること
- **最小特権の維持**: 定期的（四半期ごとを推奨）に権限マトリクスをレビューし、不要な権限を削除すること
- **監査エージェントの制約**: Auditor 系エージェントには `editFiles` と `agent` を付与しないこと（独立監査の原則）
